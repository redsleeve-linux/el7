From de0ffc327adf837d9daf7577421f9d50bf754077 Mon Sep 17 00:00:00 2001
Message-Id: <de0ffc327adf837d9daf7577421f9d50bf754077@dist-git>
From: =?UTF-8?q?J=C3=A1n=20Tomko?= <jtomko@redhat.com>
Date: Tue, 28 Jun 2016 15:23:58 +0200
Subject: [PATCH] hvsupport: skip non-matching lines early

Most of the lines we look at are not going to match one of the
driver types contained in $groups_regex.

Move on to the next line if it does not contain any of them early.
This speeds up the script execution by 50%, since this simple regex
does not have any capture groups.

(cherry picked from commit f1bbf57caddaddeea1141bfab9699a709aa303eb)

https://bugzilla.redhat.com/show_bug.cgi?id=1286679
Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
---
 docs/hvsupport.pl | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/docs/hvsupport.pl b/docs/hvsupport.pl
index fca83ca..2ead2cf 100755
--- a/docs/hvsupport.pl
+++ b/docs/hvsupport.pl
@@ -212,6 +212,9 @@ foreach my $src (@srcs) {
     my $impl;
     while (defined($line = <FILE>)) {
         if (!$ingrp) {
+            #Â skip non-matching lines early to save time
+            next if not $line =~ /$groups_regex/;
+
             if ($line =~ /^\s*(?:static\s+)?($groups_regex)\s+(\w+)\s*=\s*{/ ||
                 $line =~ /^\s*(?:static\s+)?($groups_regex)\s+NAME\(\w+\)\s*=\s*{/) {
                 $ingrp = $1;
-- 
2.9.2

