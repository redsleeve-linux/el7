From e971b5b913bc215ffb82419ae3db24a17ea094e8 Mon Sep 17 00:00:00 2001
Message-Id: <e971b5b913bc215ffb82419ae3db24a17ea094e8@dist-git>
From: =?UTF-8?q?Marek=20Marczykowski-G=C3=B3recki?=
 <marmarek@invisiblethingslab.com>
Date: Wed, 24 May 2017 12:56:09 -0400
Subject: [PATCH] pci: fix link maximum speed detection
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Commit 8e09663 "pci: recognize/report GEN4 (PCIe 4.0) card 16GT/s Link
speed" introduced another speed into enum, but mistakenly also altered
field width, so one bit of link width was included there.

Resolves: https://bugzilla.redhat.com/1455017

Signed-off-by: Marek Marczykowski-GÃ³recki <marmarek@invisiblethingslab.com>
(cherry picked from commit 1128769f9ee50bb250333a5a5d276afbe74711ea)
Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
---
 src/util/virpci.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/util/virpci.c b/src/util/virpci.c
index c89b94b5f..a2db65d7d 100644
--- a/src/util/virpci.c
+++ b/src/util/virpci.c
@@ -147,7 +147,7 @@ struct _virPCIDeviceList {
 #define PCI_EXP_DEVCAP          0x4     /* Device capabilities */
 #define PCI_EXP_DEVCAP_FLR     (1<<28)  /* Function Level Reset */
 #define PCI_EXP_LNKCAP          0xc     /* Link Capabilities */
-#define PCI_EXP_LNKCAP_SPEED    0x0001f /* Maximum Link Speed */
+#define PCI_EXP_LNKCAP_SPEED    0x0000f /* Maximum Link Speed */
 #define PCI_EXP_LNKCAP_WIDTH    0x003f0 /* Maximum Link Width */
 #define PCI_EXP_LNKSTA          0x12    /* Link Status */
 #define PCI_EXP_LNKSTA_SPEED    0x000f  /* Negotiated Link Speed */
-- 
2.13.0

