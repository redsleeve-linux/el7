From 4725cd29a4f3767be4f995f601bcff4c3208f8bf Mon Sep 17 00:00:00 2001
From: Jacco Ligthart <jacco@redsleeve.org>
Date: Fri, 20 Sep 2019 02:56:02 +0200
Subject: [PATCH] Roll in RedSleeve Branding

---
 SOURCES/sos-3.7-redsleeve-branding.patch | 106 +++++++++++++++++++++++++++++++
 SPECS/sos.spec                           |   7 +-
 2 files changed, 111 insertions(+), 2 deletions(-)
 create mode 100644 SOURCES/sos-3.7-redsleeve-branding.patch

diff --git a/SOURCES/sos-3.7-redsleeve-branding.patch b/SOURCES/sos-3.7-redsleeve-branding.patch
new file mode 100644
index 0000000..649934d
--- /dev/null
+++ b/SOURCES/sos-3.7-redsleeve-branding.patch
@@ -0,0 +1,106 @@
+diff -uNrp sos-3.6.orig/sos/policies/redhat.py sos-3.6/sos/policies/redhat.py
+--- sos-3.6.orig/sos/policies/redhat.py	2018-11-04 17:44:59.513116585 +0000
++++ sos-3.6/sos/policies/redhat.py	2018-11-04 17:53:28.333731059 +0000
+@@ -32,9 +32,9 @@ OS_RELEASE = "/etc/os-release"
+ 
+ 
+ class RedHatPolicy(LinuxPolicy):
+-    distro = "Red Hat"
+-    vendor = "Red Hat"
+-    vendor_url = "http://www.redhat.com/"
++    distro = "RedSleeve"
++    vendor = "RedSleeve"
++    vendor_url = "http://www.redsleeve.org/"
+     _redhat_release = '/etc/redhat-release'
+     _tmp_dir = "/var/tmp"
+     _rpmq_cmd = 'rpm -qa --queryformat "%{NAME}|%{VERSION}|%{RELEASE}\\n"'
+@@ -92,9 +92,9 @@ class RedHatPolicy(LinuxPolicy):
+ 
+     @classmethod
+     def check(cls):
+-        """This method checks to see if we are running on Red Hat. It must be
++        """This method checks to see if we are running on RedSleeve. It must be
+         overriden by concrete subclasses to return True when running on a
+-        Fedora, RHEL or other Red Hat distribution or False otherwise."""
++        Fedora, RHEL, CentOS or RedSleeve distribution or False otherwise."""
+         return False
+ 
+     def check_usrmove(self, pkgs):
+@@ -185,7 +185,7 @@ class RedHatPolicy(LinuxPolicy):
+         return self.host_name()
+ 
+ 
+-# Container environment variables on Red Hat systems.
++# Container environment variables on RedSleeve systems.
+ ENV_CONTAINER = 'container'
+ ENV_HOST_SYSROOT = 'HOST'
+ 
+@@ -230,9 +230,9 @@ rhel_presets = {
+ 
+ 
+ class RHELPolicy(RedHatPolicy):
+-    distro = RHEL_RELEASE_STR
+-    vendor = "Red Hat"
+-    vendor_url = "https://access.redhat.com/support/"
++    distro = "RedSleeve Linux"
++    vendor = "RedSleeve"
++    vendor_url = "https://www.redsleeve.org/"
+     msg = _("""\
+ This command will collect diagnostic and configuration \
+ information from this %(distro)s system and installed \
+@@ -262,7 +262,7 @@ No changes will be made to system config
+     def check(cls):
+         """Test to see if the running host is a RHEL installation.
+ 
+-            Checks for the presence of the "Red Hat Enterprise Linux"
++            Checks for the presence of the "RedSleeve Linux"
+             release string at the beginning of the NAME field in the
+             `/etc/os-release` file and returns ``True`` if it is
+             found, and ``False`` otherwise.
+@@ -324,7 +324,7 @@ No changes will be made to system config
+ 
+ ATOMIC = "atomic"
+ ATOMIC_RELEASE_STR = "Atomic"
+-ATOMIC_DESC = "Red Hat Enterprise Linux Atomic Host"
++ATOMIC_DESC = "RedSleeve Linux Atomic Host"
+ 
+ atomic_presets = {
+     ATOMIC: PresetDefaults(name=ATOMIC, desc=ATOMIC_DESC, note=NOTE_TIME,
+@@ -333,7 +333,7 @@ atomic_presets = {
+ 
+ 
+ class RedHatAtomicPolicy(RHELPolicy):
+-    distro = "Red Hat Atomic Host"
++    distro = "RedSleeve Atomic Host"
+     msg = _("""\
+ This command will collect diagnostic and configuration \
+ information from this %(distro)s system.
+diff -uNrp sos-3.7.orig/sos/policies/redhat.py sos-3.7/sos/policies/redhat.py
+--- sos-3.7.orig/sos/policies/redhat.py	2019-08-07 15:24:23.198233507 +0000
++++ sos-3.7/sos/policies/redhat.py	2019-08-07 15:29:08.324131718 +0000
+@@ -198,7 +198,7 @@ _cb_plugs = ['abrt', 'block', 'boot', 'd
+              'hardware', 'host', 'kernel', 'logs', 'lvm2', 'memory', 'rpm',
+              'process', 'systemd', 'yum', 'xfs']
+ 
+-RHEL_RELEASE_STR = "Red Hat Enterprise Linux"
++RHEL_RELEASE_STR = "RedSleeve Linux"
+ 
+ RHV = "rhv"
+ RHV_DESC = "Red Hat Virtualization"
+@@ -207,13 +207,13 @@ RHEL = "rhel"
+ RHEL_DESC = RHEL_RELEASE_STR
+ 
+ RHOSP = "rhosp"
+-RHOSP_DESC = "Red Hat OpenStack Platform"
++RHOSP_DESC = "RDO"
+ 
+ RHOCP = "ocp"
+-RHOCP_DESC = "OpenShift Container Platform by Red Hat"
++RHOCP_DESC = "OpenShift"
+ 
+ RH_SATELLITE = "satellite"
+-RH_SATELLITE_DESC = "Red Hat Satellite"
++RH_SATELLITE_DESC = "Satellite"
+ SAT_OPTS = SoSOptions(verify=True, plugopts=['apache.log=on'])
+ 
+ CB = "cantboot"
diff --git a/SPECS/sos.spec b/SPECS/sos.spec
index 7fb5ab0..3873536 100644
--- a/SPECS/sos.spec
+++ b/SPECS/sos.spec
@@ -2,7 +2,7 @@
 Summary: A set of tools to gather troubleshooting information from a system
 Name: sos
 Version: 3.7
-Release: 6%{?dist}
+Release: 6%{?dist}.redsleeve
 Group: Applications/System
 Source0: https://github.com/sosreport/sos/archive/%{version}.tar.gz
 License: GPLv2+
@@ -29,7 +29,7 @@ Patch7: sos-bz1706060-vdsm-plugin.patch
 Patch8: sos-bz1711305-katello-qpid-certificate.patch
 Patch9: sos-bz1736424-timeouted-plugin-stop-further-collection.patch
 Patch10: sos-bz1736422-cmd-poll-performance.patch
-Patch11: sos-3.7-centos-branding.patch
+Patch11: sos-3.7-redsleeve-branding.patch
 
 
 %description
@@ -75,6 +75,9 @@ rm -rf ${RPM_BUILD_ROOT}
 %config(noreplace) %{_sysconfdir}/sos.conf
 
 %changelog
+* Fri Sep 20 2019 Jacco Ligthart <jacco@redsleeve.org> - 3.7-6.el7.redsleeve
+- Roll in RedSleeve Branding
+
 * Tue Sep 03 2019 CentOS Sources <bugs@centos.org> - 3.7-6.el7.centos
 - Roll in CentOS Branding
 
-- 
1.8.3.1

