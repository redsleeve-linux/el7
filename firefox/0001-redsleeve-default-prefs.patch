From f3d4fa3c0a0839b3b6812439f4de14c40e80ea56 Mon Sep 17 00:00:00 2001
From: Jacco Ligthart <jacco@redsleeve.org>
Date: Sat, 19 May 2018 11:34:28 +0200
Subject: [PATCH] redsleeve default prefs

---
 SOURCES/firefox-redsleeve-default-prefs.js | 27 +++++++++++++++++++++++++++
 SPECS/firefox.spec                         | 12 ++++++++----
 2 files changed, 35 insertions(+), 4 deletions(-)
 create mode 100644 SOURCES/firefox-redsleeve-default-prefs.js

diff --git a/SOURCES/firefox-redsleeve-default-prefs.js b/SOURCES/firefox-redsleeve-default-prefs.js
new file mode 100644
index 0000000..8327af8
--- /dev/null
+++ b/SOURCES/firefox-redsleeve-default-prefs.js
@@ -0,0 +1,27 @@
+pref("app.update.auto",                     false);
+pref("app.update.enabled",                  false);
+pref("app.update.autoInstallEnabled",       false);
+pref("browser.backspace_action",            2);
+pref("browser.display.use_system_colors",   true);
+pref("browser.download.folderList",         1);
+pref("browser.link.open_external",          3);
+pref("browser.shell.checkDefaultBrowser",   false);
+pref("general.smoothScroll",                true);
+pref("general.useragent.vendor",            "RedSleeve");
+pref("general.useragent.vendorSub",         "FIREFOX_RPM_VR");
+pref("intl.locale.matchOS",                 true);
+pref("storage.nfs_filesystem",              false);
+pref("dom.ipc.plugins.enabled.nswrapper*",  false);
+pref("network.manage-offline-status",       true);
+pref("toolkit.networkmanager.disable",      false);
+pref("browser.startup.homepage",            "data:text/plain,browser.startup.homepage=file:///usr/share/doc/HTML/index.html");
+pref("toolkit.storage.synchronous",         0);
+pref("startup.homepage_override_url",       "http://www.redsleeve.org");
+pref("startup.homepage_welcome_url",        "http://www.redsleeve.org");
+pref("extensions.shownSelectionUI",         true);
+/* Workaround for rhbz#1110291 */
+pref("network.negotiate-auth.allow-insecure-ntlm-v1", true);
+/* Workaround for mozbz#1063315 */
+pref("security.use_mozillapkix_verification", false);
+pref("geo.wifi.uri", "https://location.services.mozilla.com/v1/geolocate?key=%MOZILLA_API_KEY%");
+pref("browser.tabs.remote.autostart",       false);
diff --git a/SPECS/firefox.spec b/SPECS/firefox.spec
index f570467..e623e5e 100644
--- a/SPECS/firefox.spec
+++ b/SPECS/firefox.spec
@@ -77,7 +77,7 @@
 Summary:        Mozilla Firefox Web browser
 Name:           firefox
 Version:        52.8.0
-Release:        1%{?dist}
+Release:        1%{?dist}.redsleeve
 URL:            http://www.mozilla.org/projects/firefox/
 License:        MPLv1.1 or GPLv2+ or LGPLv2+
 Group:          Applications/Internet
@@ -91,7 +91,7 @@ Source0:        firefox-%{version}%{?ext_version}.source.tar.xz
 Source1:        firefox-langpacks-%{version}%{?ext_version}-20180509.tar.xz
 %endif
 Source10:       firefox-mozconfig
-Source12:       firefox-centos-default-prefs.js
+Source12:       firefox-redsleeve-default-prefs.js
 Source20:       firefox.desktop
 Source600:      firefox.sh.in.rhel6
 Source700:      firefox.sh.in.rhel7
@@ -640,8 +640,8 @@ MOZ_SMP_FLAGS=-j1
 [ -z "$RPM_BUILD_NCPUS" ] && \
      RPM_BUILD_NCPUS="`/usr/bin/getconf _NPROCESSORS_ONLN`"
 [ "$RPM_BUILD_NCPUS" -ge 2 ] && MOZ_SMP_FLAGS=-j2
-[ "$RPM_BUILD_NCPUS" -ge 4 ] && MOZ_SMP_FLAGS=-j4
-[ "$RPM_BUILD_NCPUS" -ge 8 ] && MOZ_SMP_FLAGS=-j8
+#[ "$RPM_BUILD_NCPUS" -ge 4 ] && MOZ_SMP_FLAGS=-j4
+#[ "$RPM_BUILD_NCPUS" -ge 8 ] && MOZ_SMP_FLAGS=-j8
 
 MOZ_APP_DIR=%{_libdir}/%{name}
 
@@ -885,6 +885,10 @@ gtk-update-icon-cache %{_datadir}/icons/hicolor &>/dev/null || :
 #---------------------------------------------------------------------
 
 %changelog
+* Sat May 19 2018 Jacco Ligthart <jacco@redsleeve.org> - 52.8.0-1.el7.redsleeve
+- redsleeve default prefs
+- limited the number of CPU's for building to 2 (OOM otherwise)
+
 * Mon May 14 2018 Johnny Hughes <johnny@centos.org> - 52.8.0-1
 - Manual CentOS Debranding
 
-- 
1.8.3.1

