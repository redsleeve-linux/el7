From 0a1ad3e4dd41311eec2c559cb9543fc2b91204cf Mon Sep 17 00:00:00 2001
From: Jacco Ligthart <jacco@redsleeve.org>
Date: Tue, 13 Dec 2016 21:55:19 +0100
Subject: [PATCH] added an arm patch

---
 SOURCES/nss-softokn-3.16-arm.patch | 12 ++++++++++++
 SPECS/nss-softokn.spec             |  7 ++++++-
 2 files changed, 18 insertions(+), 1 deletion(-)
 create mode 100644 SOURCES/nss-softokn-3.16-arm.patch

diff --git a/SOURCES/nss-softokn-3.16-arm.patch b/SOURCES/nss-softokn-3.16-arm.patch
new file mode 100644
index 0000000..eb5c1f7
--- /dev/null
+++ b/SOURCES/nss-softokn-3.16-arm.patch
@@ -0,0 +1,12 @@
+diff -ruN nss-orig/lib/freebl/lowhash_vector.c nss/lib/freebl/lowhash_vector.c
+--- nss-orig/lib/freebl/lowhash_vector.c	2015-06-25 23:44:00.547713385 +0200
++++ nss/lib/freebl/lowhash_vector.c	2015-06-25 23:45:21.202553235 +0200
+@@ -99,7 +99,7 @@
+ static PRCallOnceType loadFreeBLOnce;
+ /* remove when NSPR pratom.h is updated. s390 has atomic intrinsics,
+  * but nspr doesn't know it. */
+-#if defined(__s390__) || defined(__s390x__)
++#if defined(__s390__) || defined(__s390x__) || defined(__arm__)
+ #undef PR_ATOMIC_SET
+ #define PR_ATOMIC_SET(val, newval) __sync_lock_test_and_set(val, newval)
+ #endif
diff --git a/SPECS/nss-softokn.spec b/SPECS/nss-softokn.spec
index c985b78..116ed1a 100644
--- a/SPECS/nss-softokn.spec
+++ b/SPECS/nss-softokn.spec
@@ -32,7 +32,7 @@
 Summary:          Network Security Services Softoken Module
 Name:             nss-softokn
 Version:          3.16.2.3
-Release:          14.4%{?dist}
+Release:          14.4%{?dist}.redsleeve
 License:          MPLv2.0
 URL:              http://www.mozilla.org/projects/security/pki/nss/
 Group:            System Environment/Libraries
@@ -116,6 +116,7 @@ Patch204:	limit-create-fipscheck.patch
 Patch205:	nss-softokn-3.16-tls12-mechanisms-fipstest.patch
 # https://bugzilla.redhat.com/show_bug.cgi?id=1053437
 Patch206:   skip-check-fork-in_GetFunctionList.patch
+Patch10001:	nss-softokn-3.16-arm.patch
 
 %description
 Network Security Services Softoken Cryptographic Module
@@ -199,6 +200,7 @@ popd
 pushd nss
 %patch102 -p1 -b .extra_check
 popd
+%patch10001 -p0 -b .arm
 
 %build
 
@@ -511,6 +513,9 @@ done
 %{_includedir}/nss3/shsign.h
 
 %changelog
+* Fri Nov 04 2016 Jacco Ligthart <jacco@redsleeve.org> - 3.16.2.3-14.4.redsleeve
+- added an arm patch
+
 * Tue Jun 28 2016 Kai Engert <kaie@redhat.com> - 3.16.2.3-14.4
 - escape all percent characters in all changelog comments
 
-- 
1.8.3.1

