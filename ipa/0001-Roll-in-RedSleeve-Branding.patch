From cba7647b76ce624c696e466a764a4d61c548bbc1 Mon Sep 17 00:00:00 2001
From: Jacco Ligthart <jacco@redsleeve.org>
Date: Tue, 13 Dec 2016 21:44:16 +0100
Subject: [PATCH] Roll in RedSleeve Branding

---
 SOURCES/ipa-redsleeve-branding.patch | 28 ++++++++++++++++++++++++++++
 SPECS/ipa.spec                       |  7 +++++--
 2 files changed, 33 insertions(+), 2 deletions(-)
 create mode 100644 SOURCES/ipa-redsleeve-branding.patch

diff --git a/SOURCES/ipa-redsleeve-branding.patch b/SOURCES/ipa-redsleeve-branding.patch
new file mode 100644
index 0000000..dbc81ab
--- /dev/null
+++ b/SOURCES/ipa-redsleeve-branding.patch
@@ -0,0 +1,28 @@
+diff --git a/ipaplatform/base/paths.py b/ipaplatform/base/paths.py
+index af50262..5090062 100644
+--- a/ipaplatform/base/paths.py
++++ b/ipaplatform/base/paths.py
+@@ -99,6 +99,7 @@ class BasePathNamespace(object):
+     PKI_TOMCAT_ALIAS_DIR = "/etc/pki/pki-tomcat/alias/"
+     PKI_TOMCAT_PASSWORD_CONF = "/etc/pki/pki-tomcat/password.conf"
+     ETC_REDHAT_RELEASE = "/etc/redhat-release"
++    ETC_REDSLEEVE_RELEASE = "/etc/redsleeve-release"
+     RESOLV_CONF = "/etc/resolv.conf"
+     SAMBA_KEYTAB = "/etc/samba/samba.keytab"
+     SMB_CONF = "/etc/samba/smb.conf"
+diff --git a/ipaserver/install/ntpinstance.py b/ipaserver/install/ntpinstance.py
+index c653525..4b0578b 100644
+--- a/ipaserver/install/ntpinstance.py
++++ b/ipaserver/install/ntpinstance.py
+@@ -44,6 +44,8 @@ class NTPInstance(service.Service):
+         os = ""
+         if ipautil.file_exists(paths.ETC_FEDORA_RELEASE):
+             os = "fedora"
++        elif ipautil.file_exists(paths.ETC_REDSLEEVE_RELEASE):
++            os = "redsleeve"
+         elif ipautil.file_exists(paths.ETC_REDHAT_RELEASE):
+             os = "rhel"
+ 
+-- 
+1.8.3.1
+
diff --git a/SPECS/ipa.spec b/SPECS/ipa.spec
index d46d747..c5ca5a9 100644
--- a/SPECS/ipa.spec
+++ b/SPECS/ipa.spec
@@ -43,7 +43,7 @@
 
 Name:           ipa
 Version:        4.4.0
-Release:        14%{?dist}
+Release:        14%{?dist}.redsleeve
 Summary:        The Identity, Policy and Audit system
 
 Group:          System Environment/Base
@@ -214,7 +214,7 @@ Patch1007:      1007-Do-not-build-tests.patch
 Patch1008:      1008-RCUE.patch
 Patch1009:      1009-Revert-Increased-mod_wsgi-socket-timeout.patch
 Patch1010:      1010-WebUI-add-API-browser-is-tech-preview-warning.patch
-Patch1011:      ipa-centos-branding.patch
+Patch1011:      ipa-redsleeve-branding.patch
 # RHEL spec file only: END
 
 %if ! %{ONLY_CLIENT}
@@ -1533,6 +1533,9 @@ fi
 
 
 %changelog
+* Sun Dec 11 2016 Jacco Ligthart <jacco@redsleeve.org> - 4.4.0-14.el7.redsleeve
+- Roll in RedSleeve Branding
+
 * Tue Dec 06 2016 CentOS Sources <bugs@centos.org> - 4.4.0-14.el7.centos
 - Roll in CentOS Branding
 
-- 
1.8.3.1

